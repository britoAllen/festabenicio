<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confirmação de presença</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        /* Centralização do Quadro */
        html, body { height: 100%; margin: 0; }
        body { 
            background-color: #f0f4f8; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .main-card { 
            width: 100%; 
            max-width: 550px; 
            border-radius: 20px; 
            border: none; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            background: #fff;
        }

        .card-header { 
            background: #2563eb; 
            color: white; 
            border-radius: 20px 20px 0 0 !important; 
            padding: 25px; 
            text-align: center;
        }

        .section-box { margin-top: 15px; }
        .input-group-text { cursor: pointer; transition: 0.2s; }
        .input-group-text:hover { background-color: #fee2e2; color: #dc3545; }
        
        /* Estilo para erro de validação */
        .is-invalid-custom { border: 2px solid #dc3545 !important; }
        .error-msg { color: #dc3545; font-size: 0.85rem; display: none; margin-bottom: 10px; }
    </style>
</head>
<body>
<div class="card main-card">
    <div class="card-header">
        <h4 class="mb-0">BENÍCIO</h4>
        <h4 class="mb-1">espera sua confirmação para essa missão divertida!</h4>
        <small>Informe nome e sobrenome de todos</small>
    </div>
    <div class="card-body p-4">
        <form id="formPresenca">
            <div class="row g-3 mb-4">
                <div class="col-6">
                    <label class="form-label fw-bold">Nº Adultos</label>
                    <input type="number" id="qtdeAdultos" class="form-control form-control-lg" min="0" value="0" oninput="ajustarCampos('adulto')">
                </div>
                <div class="col-6">
                    <label class="form-label fw-bold">Nº Crianças</label>
                    <input type="number" id="qtdeCriancas" class="form-control form-control-lg" min="0" value="0" oninput="ajustarCampos('crianca')">
                </div>
            </div>

            <div id="contAdultos" class="section-box"></div>
            <div id="contCriancas" class="section-box"></div>

            <div id="errorFeedback" class="error-msg alert alert-danger mt-3 text-center">
                <i class="bi bi-exclamation-triangle-fill"></i> Por favor, insira Nome e Sobrenome em todos os campos.
            </div>

            <button type="button" class="btn btn-primary w-100 py-3 mt-4 fw-bold shadow-sm" onclick="validarEEnviar()" id="btnEnviar">
                <span id="txtBtn">Confirmar Presença</span>
                <span id="loader" class="spinner-border spinner-border-sm d-none"></span>
            </button>
        </form>
        <div id="msg" class="mt-3"></div>
    </div>
</div>

<script>
    const URL_GAS = "https://script.google.com/macros/s/AKfycbxT9wkptQGAJvQ15UjAUxzL9GRY-TERjnw6cqV9Sgs0gaLLlrx2ShCUcQSLZN-_KfGwHA/exec"; // Certifique-se de colar sua URL do Apps Script aqui

    function ajustarCampos(tipo) {
        const inputQtde = document.getElementById(tipo === 'adulto' ? 'qtdeAdultos' : 'qtdeCriancas');
        const container = document.getElementById(tipo === 'adulto' ? 'contAdultos' : 'contCriancas');
        const novaQtde = parseInt(inputQtde.value) || 0;
        const camposExistentes = container.querySelectorAll('.input-group');
        const qtdeAtual = camposExistentes.length;

        if (novaQtde > qtdeAtual) {
            for (let i = qtdeAtual + 1; i <= novaQtde; i++) {
                const div = document.createElement('div');
                div.className = 'input-group mb-2';
                div.innerHTML = `
                    <span class="input-group-text bg-light fw-bold">${tipo[0].toUpperCase()}${i}</span>
                    <input type="text" class="form-control nome-${tipo}" placeholder="Nome e Sobrenome" oninput="this.classList.remove('is-invalid-custom')">
                    <span class="input-group-text" onclick="removerIndividual(this, '${tipo}')"><i class="bi bi-trash"></i></span>
                `;
                container.appendChild(div);
            }
        } else if (novaQtde < qtdeAtual) {
            for (let i = qtdeAtual; i > novaQtde; i--) { container.lastChild.remove(); }
        }
    }

    function removerIndividual(elemento, tipo) {
        elemento.parentElement.remove();
        const inputQtde = document.getElementById(tipo === 'adulto' ? 'qtdeAdultos' : 'qtdeCriancas');
        inputQtde.value = Math.max(0, parseInt(inputQtde.value) - 1);
        reindexar(tipo);
    }

    function reindexar(tipo) {
        const container = document.getElementById(tipo === 'adulto' ? 'contAdultos' : 'contCriancas');
        const labels = container.querySelectorAll('.input-group-text.bg-light');
        labels.forEach((label, index) => {
            label.innerText = tipo[0].toUpperCase() + (index + 1);
        });
    }

    function validarNomeSobrenome(nome) {
        // Verifica se tem pelo menos duas palavras com 2 letras cada
        const partes = nome.trim().split(/\s+/);
        return partes.length >= 2 && partes.every(p => p.length >= 2);
    }

    async function validarEEnviar() {
        const qA = parseInt(document.getElementById('qtdeAdultos').value) || 0;
        const qC = parseInt(document.getElementById('qtdeCriancas').value) || 0;
        const feedback = document.getElementById('errorFeedback');
        const msg = document.getElementById('msg');
        
        feedback.style.display = 'none';
        msg.innerHTML = '';

        if (qA === 0 && qC === 0) {
            msg.innerHTML = `<div class="alert alert-warning text-center">Adicione ao menos 1 pessoa.</div>`;
            return;
        }

        // Validação de Nomes
        const todosInputs = document.querySelectorAll('.nome-adulto, .nome-crianca');
        let erroValidacao = false;

        todosInputs.forEach(input => {
            if (!validarNomeSobrenome(input.value)) {
                input.classList.add('is-invalid-custom');
                erroValidacao = true;
            } else {
                input.classList.remove('is-invalid-custom');
            }
        });

        if (erroValidacao) {
            feedback.style.display = 'block';
            return;
        }

        const btn = document.getElementById('btnEnviar');
        btn.disabled = true;
        document.getElementById('txtBtn').innerText = "Enviando...";
        document.getElementById('loader').classList.remove('d-none');

        const nomesA = Array.from(document.querySelectorAll('.nome-adulto')).map(i => i.value).join('; ');
        const nomesC = Array.from(document.querySelectorAll('.nome-crianca')).map(i => i.value).join('; ');

        try {
            await fetch(URL_GAS, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ qtdeA: qA, qtdeC: qC, nomesA: nomesA, nomesC: nomesC })
            });

            msg.innerHTML = `<div class="alert alert-success text-center">✔ Yes! Presença confirmada!</div>`;
            document.getElementById('formPresenca').reset();
            document.getElementById('contAdultos').innerHTML = '';
            document.getElementById('contCriancas').innerHTML = '';
        } catch (e) {
            msg.innerHTML = `<div class="alert alert-danger text-center">Erro ao conectar.</div>`;
        } finally {
            btn.disabled = false;
            document.getElementById('txtBtn').innerText = "Confirmar Presença";
            document.getElementById('loader').classList.add('d-none');
        }
    }
</script>

</body>
</html>
